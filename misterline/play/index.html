<!doctype html>


<!--

/*


	We have used the following open source projects / code:

	pixi.js - v2.2.3
	Copyright (c) 2012-2014, Mat Groves
	http://goodboydigital.com/
	pixi.js is licensed under the MIT License.
	http://www.opensource.org/licenses/mit-license.php
	Mat Groves http://matgroves.com/ @Doormat23

	Class object based on John Resig's code; inspired by base2 and Prototype
	http://ejohn.org/blog/simple-javascript-inheritance/

	Fonts in use: Montserrat

	Music By:


	
*/

-->


<html>
    

<head>
        

<meta charset="UTF-8" />
     
<!--<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Montserrat">-->
<title>Mister Line</title>
      

<meta name="description" content="Mister Line">
	
<link rel="canonical" href="http://www.zblip.com/misterline"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!--<meta name="viewport" content="user-scalable=no" /> why stop users scaling?-->

<!--<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1, maximum-scale=1">-->

<!--<meta name="viewport" content="width=device-width"> weird scaling -->
<!--<meta name="viewport" content="width=device-height">-->

<!-- https://developers.google.com/web/fundamentals/design-and-ui/responsive/?hl=en#set-the-viewport -->
<!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->



	<!-- <script src='https://www.kongregate.com/javascripts/kongregate_api.js'></script> -->


	<style type="text/css">	body { padding: 0; margin: 0; }</style>


</head>
    

<body>

    

<!--

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.9&appId=1079707205462152";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

-->

<!--<script src="phaser-slim.min.js"></script>-->
<script src="src/core.js"></script>
<script src="src/asset_manager.js"></script>	
		

<style>
    	

	@font-face {
				font-family: 'Montserrat';
				src: url('fonts/Montserrat.ttf');
				//local('Montserrat');
				//url(https://fonts.googleapis.com/css?family=Montserrat);
	}

	body{
				overflow:hidden;
				margin:0;
			     	font-family: 'Montserrat', sans-serif;
			     	background: #8C8ACC;	}
				.fontPreload {
		  		font-family: 'Montserrat';
		  		position:absolute;
		  		left:-100px;
	}
<!--
.fb-like-container {
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.fb-like-old {
  position: fixed;
  margin-right: 100%;
 

  
}

.fb-dummy-left {
  position: absolute;
  right: 20px;
  bottom: 20px;
 

  
}

.fb-like {
 	 position: relative;
 	 right: 0px;
}
-->
	
	progress {
  		border: none;
		-webkit-appearance: none;
		width: 400px;
		height: 14px;
		margin: 50px auto;
		display: block;

	}

	progress::-webkit-progress-bar {
 		background-color: #000000;
  		border: 0;
  		height: 18px;
  		border-radius: 50px;
	padding: 2px;

		box-shadow: 0 1px 0px 0 rgba(255, 255, 255, 0.2);
	}

	progress::-webkit-progress-value {
		border-radius: 50px;
	box-shadow: inset 0 1px 1px 0 rgba(255, 255, 255, 0.4);
	background:
		-webkit-linear-gradient(45deg, transparent, transparent 33%, rgba(0, 0, 0, 0.1) 33%, rgba(0, 0, 0, 0.1) 66%, transparent 66%),
		-webkit-linear-gradient(top, rgba(255, 255, 255, 0.25), rgba(0, 0, 0, 0.2)),
		-webkit-linear-gradient(left, #8F27da, #7024A7);
		//-webkit-linear-gradient(left, #ba7448, #c4672d);
		//-webkit-linear-gradient(left, #8F27da, #7024A7);
	
	/* Looks great, now animating it */
	background-size: 25px 14px, 100% 100%, 100% 100%;
	-webkit-animation: move 5s linear 0 infinite;
	}

	progress::-moz-progress-bar {
  		background-color: #000000;
  		border: 0;
  		height: 18px;
  		border-radius: 9px;
	}

	

   </style>



<div id = 'pbar' >
	
	<div id = 'splashdiv' align = "center" width ="100%" overflow ="hidden">
		<img id = 'splash' src = 'assets/title2.png'>
	</div>
	<progress id='prog_bar' value = '0' max='100'></progress>
</div>

<!--
<div class = "fb-like-container">
<div class = "fb-dummy-left">
<div class="fb-like" data-href="http://www.zblip.com/braincross" data-layout="standard" data-action="like" data-size="small" data-show-faces="false" data-share="true"></div>
</div>
</div>
-->

<!-- <script src='https://www.kongregate.com/javascripts/kongregate_api.js'></script> -->

<script type="text/javascript">

    

var using_pixi = true;;//false;
var using_phaser = false;//true;

var game;	// used by phaser
var assets_loaded = false;
var scriptList = [

		
		//"phaser.min.js",

		//"playtomic.js",

		//"src/boot.js",
		//"src/preload.js",
		//"src/gametitle.js",		
		//"src/thegame.js",

		//"assets/blocks.png",
		//"assets/blocks.json",

		"src/spritewrapper.js",
		"src/game_engine.js",
		"src/game_state.js",
		"src/entity_class.js",
		
		"src/sound_manager.js",
	];

var g_servermode = false;
//g_servermode = true;
if (g_servermode == true) scriptList.push("server/solver_class.js");

if (using_pixi == true) {
	scriptList.push("pixi.min.js");
	scriptList.push("src/pixigame.js");
} else {
	scriptList.push("phaser-slim.min.js");
	scriptList.push("src/thegame.js");
}
// https://cookieconsent.insites.com/download/

//if (location.hostname == "www.kongregate.com") scriptList.push("http://www.kongregate.com/javascripts/kongregate_api.js");

var on_kong = 0;

var g_solver_class = null;

using_cocoon_js = false;

var browser_url = "";

if (using_cocoon_js == false) browser_url = (window.location != window.parent.location)
            ? document.referrer
            : document.location.href;

browser_url = browser_url.split("/")[2];

var location_hostname = "";
if (using_cocoon_js == false) location_hostname = location.hostname;

if (location_hostname == "game274082.konggames.com" ||
	browser_url == "www.kongregate.com" ||
	browser_url == "http://www.kongregate.com/games/ZBlip/braincross" ||
	browser_url == "http://www.kongregate.com/games/ZBlip/braincross/" ||
	browser_url == "http://www.kongregate.com/games/ZBlip/braincross_preview/" ||
	browser_url == "www.kongregate.com/games/ZBlip/braincross/" ||
	browser_url == "www.kongregate.com/games/ZBlip/braincross") on_kong = 1;	// not www.kongregate.com 

on_kong = 0;	

console.log('browser url ' + browser_url);



if (on_kong == 1) scriptList.push("https://www.kongregate.com/javascripts/kongregate_api.js");

var on_facebook = 0;

if (location_hostname == "www.facebook.com") on_facebook = 1;

var g_autoload_level = document.location.search;
if (g_autoload_level.length > 1) g_autoload_level = g_autoload_level.substring(1);

g_autoload_level = g_autoload_level.split("=")[1];

if (on_kong == 1 || location_hostname != "www.zblip.com") g_autoload_level = "";

console.log('g_autoload_level' + g_autoload_level);

var kongregate;
var kong_token;



cordova_ready = false;
on_cordova_ready = function() {
	cordova_ready = true;
};

if (using_cocoon_js == true) {
	scriptList.push("cocoon.min.js");
	scriptList.push("cordova.js");
	document.addEventListener('deviceready', on_cordova_ready, false);

}

//alert('<!--<meta name="viewport" content="width=device-width">-->');

if (using_cocoon_js == false) var pBar = document.getElementById('prog_bar');
else var pBar = {value: 0};
pBar.value += 20; 


window.onload = function () {
	if (using_pixi == true) load_script_assets(scriptList, start_pixi);
	else load_script_assets(scriptList, start_phaser);

	pBar.value += 10; 
};

start_pixi = function () {
	pBar.value += 10; 

	

	// pixi is for cocoon, so not checking kongregate
	if (on_kong == 1) {
		// Load the API
	
		kongregateAPI.loadAPI(function(){
		
			// Callback function
			// Set the global kongregate API object
  			kongregate = kongregateAPI.getAPI();

			// Register the shared content load listener before connecting
			//kongregate.sharedContent.addLoadListener('Level', onLoadLevel);
   
			// Connect
			kongregate.services.connect();	// I'm guessing I need this for auth
		
		});

	}


	setup_layers();

	


	loadpixiimages();
	
	
};

start_phaser = function() {

	pBar.value += 10; 

	

			
	if (on_kong == 1) {
		// Load the API
	
		kongregateAPI.loadAPI(function(){
		
			// Callback function
			// Set the global kongregate API object
  			kongregate = kongregateAPI.getAPI();


			// Register the shared content load listener before connecting
			//kongregate.sharedContent.addLoadListener('Level', onLoadLevel);
   
			// Connect
			kongregate.services.connect();	// I'm guessing I need this for auth


		

		});

	}

	var phaser_type = Phaser.CANVAS;

	if (using_cocoon_js == true) phaser_type = Phaser.AUTO;	// using_cocoon lives in game_engine.js


	// window.devicePixelRatio

	game = new Phaser.Game(document.documentElement.clientWidth, 
			       document.documentElement.clientHeight, 
			       phaser_type, "game", {
    		create : function() {
        		this.game.stage.backgroundColor = "0x061419";
		}
    	});

	

	Phaser.Canvas.setSmoothingEnabled(game, false);


				//game.renderer.renderSession.roundPixels = true;
				//Phaser.Canvas.setImageRenderingCrisp(game.canvas);
				//Phaser.Canvas.setSmoothingEnabled(game.canvas, false);
				//PIXI.scaleModes.DEFAULT = PIXI.scaleModes.BEST;

	
				// remove_splash();

				// 8176

				//Playtomic.initialize("aaa", "aaa", "http://salty-ravine-95905.herokuapp.com");
				//Playtomic.initialize("aaa", "aaa", "localhost");
	
				game.state.add("Boot",boot);
				game.state.add("Preload",preload);
				//game.state.add("GameTitle",gameTitle);
				game.state.add("TheGame",theGame);

				//

	
				
				game.state.start("Boot");

				
				

				
				

				
			
	if (game.stage != null) game.stage.backgroundColor = "0x061419";
};

g_splash_parent = null;
g_splash_image = null;

remove_splash = function() {

	if (using_cocoon_js == false && pBar.parentNode != null) {
	 	pBar.parentNode.removeChild(pBar);	// remove the progress bar
	}

			var splash = document.getElementById('splash');
				if (splash != null) {
					
					//g_splash_parent = splash.parentNode;
					splash.parentNode.removeChild(splash);

					//g_splash_image = splash;
				}

	do_resize();
};

show_splash = function () {
		//var splash_parent = document.getElementById('prog_bar');
		//g_splash_parent.appendChild(g_splash_image);
};


var playSoundInstance = function(sndfile, vol) {};

var screen_width = 600;
var screen_height = 600;
var ratio = 1;		// tiles in game
var menu_ratio = 1;	// menu, pop up menu
var x_shift_screen = 0;
var y_shift_screen = 0;
var scale_man;

var menu_scale_ratio = 1;

var level_ratio = 1;
var level_x_shift = 0;

var g_level_size = 10;	// for resizing
var g_top_nono_size = 10;
var g_left_nono_size = 10;
var g_level_w = 10;
var g_level_h = 10;

var do_resize = function(e) {  

	//if (game == null) return;
	if (play_screen_group == null) return;

	// dips
	//screen_width =  document.documentElement.clientWidth - 1;//

//	screen_width =	window.innerWidth && document.documentElement.clientWidth ? 
//			Math.min(window.innerWidth, document.documentElement.clientWidth) : 
//			window.innerWidth || 
//			document.documentElement.clientWidth || 
//			document.getElementsByTagName('body')[0].clientWidth;

	screen_width = window.innerWidth;	

	screen_width = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
  	screen_height = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

	//screen_height = document.documentElement.clientHeight - 1;

	// document.body.offsetWidth ?

	window.scrollTo(0, 0);

	//if (screen.width/window.devicePixelRatio > screen_width) screen_width = screen.width/window.devicePixelRatio;
	//if (screen.height/window.devicePixelRatio > screen_height) screen_width = screen.height/window.devicePixelRatio;

	// http://www.quirksmode.org/blog/archives/2012/07/more_about_devi.html
	// screen.width on ios : width in dips
	// screen.width on android : width in physical pixels

	// ------------------------ only mention of device pixel ratio
	menu_ratio = 1;
	menu_scale_ratio = 1;
	//if (window.devicePixelRatio > 1) menu_scale_ratio = window.devicePixelRatio;

	//if (window.devicePixelRatio > 1) menu_ratio = window.devicePixelRatio;


	//var rr = screen_width / screen_height;
	//console.log('screen_width / screen_height' + rr);

	// the browser (on chrome dev mobile, at least) seems to invent its own width and height, which nonetheless maintain
	// the same ratio as the real witdh and height
	// so my in-game tile grid was resizing with no problems because it uses the approach below (w_portrait etc)
	// so i'm going to mimic this for the GUI stuff
	// note that I'm ignoring devicePixelRatio, as the browser just seems to resize everything anyway
	// my job here is just to fill the screen

	// screen_width = some_unknown_num*actual_screen_width
	// screen_height = some_unknown_num*actual_screen_height

	// maybe setting meta viewport width = 100% fixed this nonsense?

	// width = device-width will make the viewport stretch on orientation change

	if (using_pixi == true && renderer != null) {
		//this part resizes the canvas but keeps ratio the same
    		//renderer.view.style.width = (screen_width) + "px";
    		//renderer.view.style.height = (screen_height) + "px";
		renderer.resize(screen_width,screen_height);
	}

	//game_menu_group.scale.set(ratio,ratio);
	//options_menu_group.scale.set(menu_ratio,menu_ratio);

	//if (g_level_size <= 5) g_level_size = 5;	// already min of 7 set in game_state


	var h_size = Math.max(g_level_w, 7);
	var v_size = Math.max(g_level_h, 7);

	var w = (h_size)*40;
	var h = (v_size + 2.5)*40;	// room for inventory and help tips
	var w_portrait = (h_size + 0.25)*40;
	var h_portrait = (v_size)*40;// + 250;	
	

	// tile size of 47

	// in portrait - need a bottom space (for UI) of ~250 pixels
	var effective_screen_height = screen_height;
	var effective_screen_width = screen_width;

	var portrait_gui_size = Math.min(400, screen_height*0.4);
	var land_gui_size = Math.min(200, screen_width*0.4);
	if (screen_width < screen_height) effective_screen_height -= portrait_gui_size;	// GUI on the bottom
	else effective_screen_width -= land_gui_size;

	if (screen_width < screen_height) ratio = Math.min(screen_width/w_portrait, effective_screen_height/h_portrait);
	else ratio = Math.min(screen_width/w, screen_height/h);

	

	text_group.scale(ratio, ratio);		// unaffected by level size

	//ratio = ratio*level_ratio;

	play_group.scale(ratio, ratio);//.set(ratio, ratio);

	var needed_w = (g_level_w - 0)*40//w;
	if (screen_width < screen_height) needed_w = (g_level_w -0)*40//w_portrait;

	// in portrait - need a bottom space (for UI) of ~200 pixels
	if (screen_width < screen_height) {

	}
	
	
	var over_x = 0;//screen_width - (8*96);
	if (screen_width > screen_height) over_x = screen_width - w*ratio;
	else over_x = screen_width - w_portrait*ratio;

	x_shift_screen = 0;

	//var tiles_w = g_left_nono_size;
	//x_shift_screen += tiles_w*47*ratio;

	

	over_x = screen_width - needed_w*ratio;

	

	if (over_x > 0) x_shift_screen += screen_width*0.5 - 0.5*needed_w*ratio;// 0.5*over_x;
	else x_shift_screen += screen_width*0.5 - 0.5*needed_w*ratio;

	//var level_center_x = g_level_w*0.5*40;
	//var square_center_x = g_level_h*0.5*40;
	//var off_center_x = square_center_x - level_center_x;

	//alert(g_level_w - g_level_h);

	//x_shift_screen += off_center_x*ratio;

	//x_shift_screen += level_x_shift;

	

	y_shift_screen = 16; //32

	
	var tiles_h = g_top_nono_size;
	
	y_shift_screen += tiles_h*40*ratio;

	play_group.set_pos(x_shift_screen, y_shift_screen );//position.set(x_shift_screen, y_shift_screen);


	//game.width = screen_width;		// what does this do??
  	//game.height = screen_height;


 
  	//if (game.renderType === 1) {
    		//game.renderer.resize(screen_width, screen_height);		// what does this do??

    		//Phaser.Canvas.setSmoothingEnabled(game.context, false);	// what does this do??

  	//}

	//game.camera.setSize(screen_width, screen_height);	// what does this do??

	// after adjusting tile and game containers


	// So I will just sort of mimic what the tile grid is doing
	menu_ratio = ratio;

	

	var tot_ = screen_width + screen_height;
	var max_len = Math.max(screen_width, screen_height);
	
	// the corner menu tab should be ...
	
	
	// With some senisible limits - this should work within reason, maybe not for HUGE resolutions
	// Basically just a small increase in scale if needed
	menu_ratio = Math.max(1.0, menu_ratio);	// lower bound of 1.0
	menu_ratio = Math.min(1.5, menu_ratio);	// upper bound of 1.75

	


	if (screen_width > screen_height) {
		// screen_height shrink to --> 13.5*60
		menu_ratio = screen_height/(9.5*60);
		// menu_ratio =  Math.min(screen_width/250, screen_height/250);
		
	} else {
		// screen_width shrink to --> 10*60
		menu_ratio = screen_width/(7*60);
		// menu_ratio = Math.min(screen_width/250, screen_height/250);
	}

	// testing: delete if bad
	if (screen_width > screen_height) {
		// landscape
		menu_ratio = 1;
		
		
	} else {
		// portrait
		// we want the menu (250px wide) to take up 66% of screen_width
		var aim = screen_width*0.66;
		menu_ratio = aim/250;
		//menu_ratio = screen_width/(7*60);
		// menu_ratio = Math.min(screen_width/250, screen_height/250);
	}


	//menu_ratio = 1/menu_ratio;

	//if (screen_width > screen_height) menu_ratio = 1;

	//menu_ratio = 1;		// combined with <meta name="viewport" content="width=device-width"> this seems to work ok

	// why use <meta name="viewport" content="width=device-width">
	// https://sunpig.com/martin/2012/03/18/goldilocks-and-the-three-device-pixel-ratios/
	// using width=100% seems to work ok

	// ok trying something analogous to game screen resizing
	// the tile grid wanted to fill the screen...
	var w_options = 250;
	var h_options = screen_height;
	var w_options_portrait = 250;		// .menu_width
	if (screen_width > screen_height) {
		
		//menu_ratio =  Math.min(screen_width/w_options, screen_height/w_options);
		
	} else {
		
		//menu_ratio = Math.min(screen_width/w_options_portrait, screen_height/w_options_portrait);
	}


	game_menu_group.scale(menu_ratio,menu_ratio);
	// i think this should NOT change scale:
	options_menu_group.scale(menu_ratio,menu_ratio);

	screen_width = screen_width/menu_ratio;
	screen_height = screen_height/menu_ratio;

	gBlipFrogMenu.on_screen_resize();


return;

var aspectRatio = 1.5;  
aspectRatio = window.innerWidth / window.innerHeight;
if ((window.innerWidth / window.innerHeight) > aspectRatio) 

{    

	game.scale.width = window.innerWidth * aspectRatio;    
	game.scale.height = window.innerHeight;  
 
} 

else if ((window.innerWidth / window.innerHeight) < aspectRatio) {    
	game.scale.width = window.innerWidth;    
	game.scale.height = window.innerWidth / aspectRatio;  } 

else {    
	game.scale.width = window.innerWidth;    
	game.scale.height = window.innerHeight;  

}  

//
}

window.onresize = do_resize; 

window.onorientationchange = function() {
    		window.onresize();
}

    </script>

    

<!-- 48*15 -->
<canvas id="tilecanvas" width="600" height="600" style ="display:none">
</canvas>


</body>




</html>